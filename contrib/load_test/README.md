# Architecture
## Link load tester (master)
- `prepare` command : Prepare the pre-state of msgs and queries to be tested
- `start` command : Send load test requests to load generators
- `report` command : Generate report on load test results
- Set test parameters through the `config.yaml`

## Load generators (slave)
- Server that actually generates load
- Can be executed through `run-slave` command


# Quick Start
## Run link
```
make build-docker GITHUB_TOKEN={your_github_token}

./.initialize.sh docker testnet

docker-compose up
```

## Build load tester
```
make build-load-tester-docker GITHUB_TOKEN={your_github_token}
```

## Start load test
```
make load-test
```

# How to run test manually
## Run link
```
make build-docker

./.initialize.sh docker testnet

docker-compose up
```
## Build and run load generator
```
make build-load-tester-docker GITHUB_TOKEN={your_github_token}

make run-slave
```

## Send enough coins to your account
```
linkcli tx send $(linkcli keys show alice -a) {your_master_address} 100000000stake
 ```
{your_master_address} example : tlink1mrgyg2l98t9l2rur8dum7yqsv5mfwy8usws8a8

coins are used to register vusers

## Write your config.yaml
`master_mnemonic : {your_master_account_mnemonic}`
ex : tray echo noodle shop seed regret slush camp canvas crunch inflict stool fit length misery prevent borrow pact speed choose phrase ranch daughter boring

## Prepare test state
```
make prepare-load-test
```

## Start load test
```
make start-load-test
```

# Parameters of config.yaml
## Test Config
- msgs_per_tx_prepare: the number of messages per tx when prepare state
- max_gas_prepare : the max used gas for prepare tx
- msgs_per_tx_load_test: the number of messages per tx when perform load test
  - In multi msg scenario, if the value of `msgs_per_tx_load_test` increases by 1, the total number of msgs in scenario increases.
  - multi msg scenario : tx_token, tx_collection, and tx_and_query_all scenarios
  - ex) In tx_token scenario, if the value of `msgs_per_tx_load_test` increases by 1, the total number of msgs increases by 5.
- max_gas_load_test : the max used gas for load test tx
- tps: 	TPS of load to be generated per slave
- duration: load test time
- ramp_up_time : time to ramp up load (included in duration)
- throughput_threshold : It fails if the average throughput is greater than the threshold. (/sec)
                         If -1, there is no threshold
- latency_threshold : It fails if the average latency is greater than the threshold.(ms) 
                      If -1, there is no threshold
- tps_threshold : It fails if the average tps is lower than the threshold. If -1, there is no threshold
- max_workers: max workers for load generator
- output: directory for result files

## Test Target Info
- target_url: a url of the target lcd.
- chain_id: a chain id of the target chain.
- coin_name: coin name of the target network
- testnet: set whether the target chain is a testnet or not

## Master & Slaves Info
- master_mnemonic: mnemonic of the master account ( mnemonic of {your_master_address} )
- slaves: information of load generators
  - url: a url of load generator
  - mnemonic: Mnemonic of vusers of the load generator (Must be different for each load generator)
  - scenario: Scenario to be generated by load generator
  - params : parameters of the scenario

## Scenarios
### Query Scenarios
 - query_account : send queries to `/auth/accounts/{address}`
 - query_block : send queries to `/blocks_with_tx_results/{height}?fetchsize=3`
 - query_coin : send queries to `/coin/cony`
   - to test static files
 - query_simulate : send queries to `/txs/simulate`
   - params : [ ${MSG_TYPE}, ${ARGS_OF_MSG}... ]
       - ex : [ "MsgMintNFT", "1" ]
### Tx Scenarios
 - tx_empty : send txs with MsgEmpty
   - to measure basic performance of LINK framework
 - tx_send : send txs with MsgSend
 - tx_mint_nft : send txs with MsgMintNFT
    - params : [ ${NUM_NFT} ]
        - ex : [ "1" ]
 - tx_transfer_ft : send txs with MsgTransferFT
 - tx_transfer_nft : send txs with MsgTransferNFT
### Multi Msg Scenarios
 - tx_token : send txs with messages of token module
   - MsgMint, MsgTransfer, MsgGrantPermission, MsgModify, MsgBurn
 - tx_collection : send txs with messages of collection module
   - MsgMintFT, MsgTransferFT, MsgModify, MsgBurnFT, MsgAttach, MsgDetach, MsgTransferNFT, MsgBurnNFT
### Integration Scenario
- tx_and_query_all : send most kinds of queries and txs with most kinds of msgs
