# Architecture
## Link load tester (master)
- `prepare` command : Prepare the pre-state of msgs and queries to be tested
- `start` command : Send load test request to load generators
- Set test parameters through the `config.yaml`

## Load generators (slave)
- Server that actually generates load
- Can be executed through `run-slave` command


# How to run test
## Run link
```
make build-docker

./.initialize.sh docker testnet

docker-compose up
```

## Build and run load generator
```
docker build -t link-load-tester -f ./contrib/load_test/Dockerfile .

docker run -it -p 8000:8000 link-load-tester
```

## Send enough coins to your account
```
linkcli tx send $(linkcli keys show alice -a) {your_master_address} 100000000stake
 ```
{your_master_address} example : tlink1mrgyg2l98t9l2rur8dum7yqsv5mfwy8usws8a8

coins are used to register vusers

## Write your config.yaml
`master_mnemonic : {your_master_account_mnemonic}`
ex : tray echo noodle shop seed regret slush camp canvas crunch inflict stool fit length misery prevent borrow pact speed choose phrase ranch daughter boring

## Build controller and prepare test state
- fix target_url of `config.yaml` to `http://localhost:1317`
( The master will also be dockerized later )
```
make build-load-tester
./build/link-load-tester prepare
```

## Start load test
- fix target_url of `config.yaml` to `http://host.docker.internal:1317`
```
mkdir ./results; ./build/link-load-tester start
```

## Show report
```
vegeta report ./results/*.bin
vegeta plot ./results/*.bin > ~/results/results.html 
```

refer to https://github.com/tsenart/vegeta

# Parameters of config.yaml
## Test Config
- msgs_per_tx_prepare: the number of messages per transaction when prepare state
- msgs_per_tx_load_test: the number of messages per transaction when perform load test
- tps: transactions per seconds
- duration: load test time
- max_workers: max workers for load generator
- pacer_type: Determine the pattern that generates the load.
  - constant : Generate a constant load (tps).
  - linear : Generate linearly increasing loads until tps.
- output: directory for result files

## Test Target Info
- target_url: a url of the target lcd.
- chain_id: a chain id of the target chain.
- coin_name: coin name of the target network

## Master & Slaves Info
- master_mnemonic: mnemonic of the master account ( mnemonic of {your_master_address} )
- slaves: information of load generators
  -url: a url of load generator
  - mnemonic: Mnemonic of vusers of the load generator (Must be different for each load generator)
  - target_type: Type of load to be generated by load generator
    - query_account : get account query
    - tx_send : MsgSend tx
